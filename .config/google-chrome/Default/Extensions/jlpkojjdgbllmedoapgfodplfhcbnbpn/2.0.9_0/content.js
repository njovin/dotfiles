"use strict";window.__PageRuler={active:!1,el:{},elements:{toolbar:null,mask:null,ruler:null,guides:null},enable:function(){var _this=this,styles=this.El.createEl("link",{id:"styles",rel:"stylesheet",href:chrome.extension.getURL("content.css")+"?"+this.version});this.El.appendEl(document.head||document.body||document.documentElement,styles),this.elements.toolbar=new this.el.Toolbar,this.elements.mask=new this.el.Mask,this.elements.guides=new this.el.Guides,this.elements.ruler=new this.el.Ruler(this.elements.toolbar,this.elements.guides),this.El.registerListener(window,"resize",function(){var rect=document.body.getBoundingClientRect(),width=rect.width,height=rect.height;_this.Dimensions.update(width,height)}),this.El.registerListener(window,"keydown",function(e){if(_this.elements.ruler.keyMoving){var modifier=e.shiftKey&&10||1,action=e.ctrlKey||e.metaKey?e.altKey?"shrink":"expand":"move",ruler=_this.elements.ruler,actions={up:{move:function(){ruler.setTop(ruler.top-modifier,!0)},expand:function(){ruler.setTop(ruler.top-modifier),ruler.setHeight(ruler.height+modifier)},shrink:function(){ruler.height>0&&ruler.setHeight(ruler.height-modifier)}},down:{move:function(){ruler.setTop(ruler.top+modifier,!0)},expand:function(){ruler.setBottom(_this.elements.ruler.bottom+modifier),ruler.setHeight(_this.elements.ruler.height+modifier)},shrink:function(){ruler.height>0&&(ruler.setTop(ruler.top+modifier),ruler.setHeight(ruler.height-modifier))}},left:{move:function(){ruler.setLeft(_this.elements.ruler.left-modifier,!0)},expand:function(){ruler.setLeft(ruler.left-modifier),ruler.setWidth(ruler.width+modifier)},shrink:function(){ruler.width>0&&ruler.setWidth(ruler.width-modifier)}},right:{move:function(){ruler.setLeft(ruler.left+modifier,!0)},expand:function(){ruler.setRight(ruler.right+modifier),ruler.setWidth(ruler.width+modifier)},shrink:function(){ruler.width>0&&(ruler.setLeft(ruler.left+modifier),ruler.setWidth(ruler.width-modifier))}}},keyMap={38:"up",40:"down",37:"left",39:"right"};if(keyMap.hasOwnProperty(String(e.keyCode))){e.preventDefault();var key=keyMap[e.keyCode];actions[key][action]()}}}),this.active=!0},disable:function(){this.elements.toolbar.unshiftPage(),this.El.removeListeners(),this.El.removeElements(),this.Dimensions.removeUpdateCallbacks(),this.elements.toolbar=null,this.elements.mask=null,this.elements.ruler=null,this.active=!1},cls:function(constructor,prototype){return constructor.prototype=prototype,constructor}},function(pr){pr.Dimensions={pageLeft:0,pageRight:document.body.scrollWidth,pageTop:0,pageBottom:document.body.scrollHeight,offsetTop:function(){return document.body.getBoundingClientRect().top+window.pageYOffset-document.documentElement.clientTop},offsetLeft:function(){return document.body.getBoundingClientRect().left+window.pageXOffset-document.documentElement.clientLeft},updateCallbacks:[],addUpdateCallback:function(callback){this.updateCallbacks.push(callback)},update:function(pageWidth,pageHeight){this.pageRight=pageWidth,this.pageBottom=pageHeight;for(var i=0,ilen=this.updateCallbacks.length;ilen>i;i++)this.updateCallbacks[i](this.pageRight,this.pageBottom)},removeUpdateCallbacks:function(){for(var i=0,ilen=this.updateCallbacks.length;ilen>i;i++)this.updateCallbacks[i]=null;this.updateCallbacks=[]}}}(__PageRuler),function(pr){pr.El={elements:[],listeners:[],createEl:function(tag,attrs,listeners,text){attrs=attrs||{},attrs.id=!!attrs.id&&"page-ruler-"+attrs.id||"page-ruler";var el=document.createElement(tag);for(var attr in attrs)if(attrs.hasOwnProperty(attr)){var attrVal=attrs[attr];"cls"===attr&&(attr="class"),"class"===attr&&(attrVal=attrVal instanceof Array?"page-ruler-"+attrVal.join(" page-ruler-"):"page-ruler-"+attrVal),"for"===attr&&(attrVal="page-ruler-"+attrVal),el.setAttribute(attr,attrVal)}listeners=listeners||{};for(var type in listeners)this.registerListener(el,type,listeners[type]);return text&&(el.innerText=text),this.elements.push(el),el},appendEl:function(parent,children){children instanceof Array||(children=[children]);for(var i=0;i<children.length;i++)parent.appendChild(children[i])},registerListener:function(el,type,func){el.addEventListener(type,func,!1),this.listeners.push({el:el,type:type,func:func})},removeListeners:function(){for(;this.listeners.length>0;){var listener=this.listeners.pop();listener.el.removeEventListener(listener.type,listener.func,!1),listener=null}},removeElements:function(){for(;this.elements.length>0;){var el=this.elements.pop();el instanceof HTMLElement&&el.parentNode.removeChild(el),el=null}this.elements=[]},hasClass:function(el,cls){return el.classList.contains(cls)},addClass:function(el,cls){el.classList.add(cls)},removeClass:function(el,cls){el.classList.remove(cls)},getLeft:function(el){var boundingRect=el.getBoundingClientRect(),left=boundingRect.left||0,documentOffsetLeft=document.body.ownerDocument.defaultView.pageXOffset,offsetLeft=pr.Dimensions.offsetLeft();return left+documentOffsetLeft-offsetLeft},getTop:function(el){var boundingRect=el.getBoundingClientRect(),top=boundingRect.top||0,documentOffsetTop=document.body.ownerDocument.defaultView.pageYOffset,offsetTop=pr.Dimensions.offsetTop();return top+documentOffsetTop-offsetTop},getWidth:function(el){var boundingRect=el.getBoundingClientRect();return boundingRect.width||0},getHeight:function(el){var boundingRect=el.getBoundingClientRect();return boundingRect.height||0},getDescription:function(el,asParts){if(!el.tagName)throw"tagName does not exist";var parts={tag:el.tagName.toLowerCase(),id:"",cls:""},desc=el.tagName.toLowerCase();return parts.tag=desc,el.id&&(desc+="#"+el.id,parts.id="#"+el.id),el.classList.length>0&&(desc+="."+Array.prototype.slice.call(el.classList).join("."),parts.cls="."+Array.prototype.slice.call(el.classList).join(".")),asParts&&parts||desc},getParentNode:function(el){return el.parentNode},isIllegal:function(el){var illegalTags=["head","script","noscript"];return 1!==el.nodeType||illegalTags.indexOf(el.tagName.toLowerCase())>=0},getChildNode:function(el){var childNode=null;if(el.childNodes)for(childNode=el.firstChild;childNode&&this.isIllegal(childNode);)childNode=childNode.nextSibling;return childNode&&"head"===childNode.tagName.toLowerCase()&&(childNode=document.body),childNode},getPreviousSibling:function(el){for(var prevNode=el.previousElementSibling;prevNode&&this.isIllegal(prevNode);)prevNode=prevNode.previousElementSibling;return prevNode},getNextSibling:function(el){for(var nextNode=el.nextElementSibling;nextNode&&this.isIllegal(nextNode);)nextNode=nextNode.nextElementSibling;return nextNode},inElement:function(el,parent){for(var inParent=!1,parentNode=el.parentNode;parentNode;){if(parentNode===parent){inParent=!0;break}parentNode=parentNode.parentNode}return inParent}}}(__PageRuler),function(pr){chrome.runtime.onMessage.addListener(function(message,sender,sendResponse){switch(message.type){case"enable":pr.enable();break;case"disable":pr.disable()}sendResponse({success:!0})})}(__PageRuler),function(pr){pr.Mouse={getXY:function(e,noOffset){var x=e.pageX,y=e.pageY;if(!noOffset){var offsetX=pr.Dimensions.offsetLeft();x-=offsetX;var offsetY=pr.Dimensions.offsetTop();y-=offsetY}return{x:x,y:y}},getX:function(e){return this.getXY(e).x},getY:function(e,noOffset){return this.getXY(e,noOffset).y},getClientXY:function(e,noOffset){var x=e.clientX,y=e.clientY;return noOffset||(y-=pr.elements.toolbar.height,pr.elements.toolbar.elementMode&&(y-=pr.elements.toolbar.elementToolbar.height)),{x:x,y:y}},getClientX:function(e){return this.getClientXY(e).x},getClientY:function(e,noOffset){return this.getClientXY(e,noOffset).y}}}(__PageRuler),function(pr){pr.Util={px:function(num){return num+"px"},locale:function(message,options){var text=chrome.i18n.getMessage(message);switch(options){case"lowercase":text=text.toLocaleLowerCase();break;case"uppercase":text=text.toLocaleUpperCase()}return text},hexToRGB:function(hex,alpha){alpha=alpha||1;var shorthandRegex=/^#?([a-f\d])([a-f\d])([a-f\d])$/i;hex=hex.replace(shorthandRegex,function(m,r,g,b){return r+r+g+g+b+b});var result=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex),r=parseInt(result[1],16),g=parseInt(result[2],16),b=parseInt(result[3],16);return"rgba("+r+", "+g+", "+b+", "+alpha+")"}}}(__PageRuler),function(pr){pr.el.Element=pr.cls(function(dom){this.dom=dom;var config={width:pr.El.getWidth(dom),height:pr.El.getHeight(dom),top:pr.El.getTop(dom),left:pr.El.getLeft(dom)};pr.elements.ruler.reset(config)},{dom:null})}(__PageRuler),function(pr){pr.el.ElementToolbar=pr.cls(function(toolbar){var _this=this;this.toolbar=toolbar,this.dom=pr.El.createEl("div",{id:"element-toolbar"},{click:function(e){e.stopPropagation()},mousedown:function(e){e.stopPropagation()}}),this.els.helpContainer=this.generateHelpContainer(),this.els.elementContainer=this.generateElementContainer(),this.els.navigationContainer=this.generateNavigationContainer();var trackingModeContainer=this.generateTrackingModeContainer();pr.El.appendEl(this.dom,[this.els.helpContainer,this.els.elementContainer,this.els.navigationContainer,trackingModeContainer]),pr.El.registerListener(document,"click",function(e){e.preventDefault(),e.stopPropagation(),_this.tracking&&"html"!==e.target.tagName.toLowerCase()&&(_this.setTracking(!1,!0),chrome.runtime.sendMessage({action:"trackEvent",args:["Action","Element Mode Click"]}))})},{dom:null,els:{helpContainer:null,elementContainer:null,element:null,upContainer:null,up:null,downContainer:null,down:null,previousContainer:null,previous:null,nextContainer:null,next:null,navigationContainer:null,trackingContainer:null,trackingInput:null},height:30,toolbar:null,tracking:!1,element:null,show:function(){this.dom.style.setProperty("display","flex","important");var height=this.height+this.toolbar.height;this.toolbar.dom.style.setProperty("height",pr.Util.px(height),"important"),this.toolbar.shiftPage(height),this.setTracking(!0,!0),chrome.runtime.sendMessage({action:"trackEvent",args:["Action","Element Toolbar","Show"]})},hide:function(){this.dom.style.removeProperty("display"),this.toolbar.dom.style.removeProperty("height"),this.toolbar.shiftPage(this.toolbar.height),this.setTracking(!1,!0),this.element=null,this.els.helpContainer.style.removeProperty("display"),this.els.elementContainer.style.setProperty("display","none","important"),this.els.navigationContainer.style.setProperty("display","none","important"),chrome.runtime.sendMessage({action:"trackEvent",args:["Action","Element Toolbar","Hide"]})},generateHelpContainer:function(){var container=pr.El.createEl("div",{id:"element-toolbar-help-container",cls:["help-container","container"]},{},pr.Util.locale("elementToolbarHelp"));return container},generateTagContainer:function(id){var container=pr.El.createEl("div",{id:"element-toolbar-"+id}),elementTag=pr.El.createEl("span",{id:"element-toolbar-"+id+"-tag",cls:"tag"}),elementId=pr.El.createEl("span",{id:"element-toolbar-"+id+"-id",cls:"id"}),elementCls=pr.El.createEl("span",{id:"element-toolbar-"+id+"-cls",cls:"cls"});return pr.El.appendEl(container,[elementTag,elementId,elementCls]),container},generateElementContainer:function(){var _this=this,container=pr.El.createEl("div",{id:"element-toolbar-element-container",cls:["container","nav-container"],style:"display:none !important;"},{click:function(){_this.setElement(_this.element.dom),chrome.runtime.sendMessage({action:"trackEvent",args:["Action","Element Click","Element"]})}});return this.els.element=this.generateTagContainer("element"),pr.El.appendEl(container,[this.els.element]),container},generateNavigationContainer:function(){var _this=this,container=pr.El.createEl("div",{id:"element-toolbar-navigate-container",cls:"container",style:"display:none !important;"});this.els.upContainer=pr.El.createEl("div",{id:"element-toolbar-navigate-up-container",cls:"nav-container"},{click:function(){_this.setElement(pr.El.getParentNode(_this.element.dom)),chrome.runtime.sendMessage({action:"trackEvent",args:["Action","Element Click","Parent"]})}});var upImg=pr.El.createEl("img",{id:"element-toolbar-navigate-up-img",src:chrome.extension.getURL("images/arrow-up.png")});this.els.up=this.generateTagContainer("up"),pr.El.appendEl(this.els.upContainer,[upImg,this.els.up]),this.els.downContainer=pr.El.createEl("div",{id:"element-toolbar-navigate-down-container",cls:"nav-container"},{click:function(){_this.setElement(pr.El.getChildNode(_this.element.dom)),chrome.runtime.sendMessage({action:"trackEvent",args:["Action","Element Click","Child"]})}});var downImg=pr.El.createEl("img",{id:"element-toolbar-navigate-down-img",src:chrome.extension.getURL("images/arrow-down.png")});this.els.down=this.generateTagContainer("down"),pr.El.appendEl(this.els.downContainer,[downImg,this.els.down]),this.els.previousContainer=pr.El.createEl("div",{id:"element-toolbar-navigate-previous-container",cls:"nav-container"},{click:function(){_this.setElement(pr.El.getPreviousSibling(_this.element.dom)),chrome.runtime.sendMessage({action:"trackEvent",args:["Action","Element Click","Previous"]})}});var previousImg=pr.El.createEl("img",{id:"element-toolbar-navigate-previous-img",src:chrome.extension.getURL("images/arrow-left.png")});this.els.previous=this.generateTagContainer("previous"),pr.El.appendEl(this.els.previousContainer,[previousImg,this.els.previous]),this.els.nextContainer=pr.El.createEl("div",{id:"element-toolbar-navigate-next-container",cls:"nav-container"},{click:function(){_this.setElement(pr.El.getNextSibling(_this.element.dom)),chrome.runtime.sendMessage({action:"trackEvent",args:["Action","Element Click","Next"]})}});var nextImg=pr.El.createEl("img",{id:"element-toolbar-navigate-next-img",src:chrome.extension.getURL("images/arrow-right.png")});return this.els.next=this.generateTagContainer("next"),pr.El.appendEl(this.els.nextContainer,[nextImg,this.els.next]),pr.El.appendEl(container,[this.els.upContainer,this.els.downContainer,this.els.previousContainer,this.els.nextContainer]),container},generateTrackingModeContainer:function(){var _this=this;this.els.trackingContainer=pr.El.createEl("div",{id:"element-toolbar-tracking-mode-container",cls:"container"});var label=pr.El.createEl("label",{id:"element-toolbar-tracking-mode-label","for":"element-toolbar-tracking-mode-input"},{},pr.Util.locale("elementToolbarTrackingMode")),lang=(navigator.language||"").split("-")[0];lang&&(lang="lang_"+lang);var toggle=pr.El.createEl("div",{id:"element-toolbar-tracking-mode-toggle",cls:"checkbox-toggle "+lang}),input=pr.El.createEl("input",{id:"element-toolbar-tracking-mode-input",type:"checkbox",checked:!0},{change:function(){_this.setTracking(this.checked,!1),chrome.runtime.sendMessage({action:"trackEvent",args:["Action","Tracking Mode Element",this.checked&&"On"||"Off"]})}});this.els.trackingInput=input;var toggleLabel=pr.El.createEl("label",{id:"element-toolbar-tracking-mode-toggle-label","for":"element-toolbar-tracking-mode-input"}),labelInner=pr.El.createEl("div",{id:"element-toolbar-tracking-mode-label-inner","class":"inner"}),labelSwitch=pr.El.createEl("div",{id:"element-toolbar-tracking-mode-label-switch","class":"switch "+lang});return pr.El.appendEl(toggleLabel,[labelInner,labelSwitch]),pr.El.appendEl(toggle,[input,toggleLabel]),pr.El.appendEl(this.els.trackingContainer,[label,toggle]),this.els.trackingContainer},setTracking:function(tracking,toggleInput){this.tracking=tracking,tracking?this.toolbar.ruler.ruler.classList.add("tracking"):this.toolbar.ruler.ruler.classList.remove("tracking"),chrome.runtime.sendMessage({action:"trackEvent",args:["Action","Tracking Mode",tracking&&"On"||"Off"]}),toggleInput&&(this.els.trackingInput.checked=tracking)},setElementDescription:function(container,element,title){try{var descParts=pr.El.getDescription(element,!0);container.querySelector(".page-ruler-tag").innerText=descParts.tag,container.querySelector(".page-ruler-id").innerText=descParts.id,container.querySelector(".page-ruler-cls").innerText=descParts.cls,container.title=title+": "+descParts.tag+descParts.id+descParts.cls}catch(e){}},setNavigation:function(direction,target){var element,container,title;switch(direction){case"up":container=this.els.upContainer,element=pr.El.getParentNode(target),title=pr.Util.locale("elementToolbarParentNode");break;case"down":container=this.els.downContainer,element=pr.El.getChildNode(target),title=pr.Util.locale("elementToolbarChildNode");break;case"previous":container=this.els.previousContainer,element=pr.El.getPreviousSibling(target),title=pr.Util.locale("elementToolbarPreviousSibling");break;case"next":container=this.els.nextContainer,element=pr.El.getNextSibling(target),title=pr.Util.locale("elementToolbarNextSibling")}!element||element===document.documentElement||element.id&&element.id.match(/^page\-ruler/)?container.style.setProperty("display","none","important"):(container.style.removeProperty("display"),this.setElementDescription(container,element,title))},setElement:function(target){null===this.element&&(this.els.helpContainer.style.setProperty("display","none","important"),this.els.elementContainer.style.removeProperty("display"),this.els.navigationContainer.style.removeProperty("display")),this.element=new pr.el.Element(target),this.setElementDescription(this.els.element,this.element.dom,pr.Util.locale("elementToolbarHighlightedElement")),this.setNavigation("up",target),this.setNavigation("down",target),this.setNavigation("previous",target),this.setNavigation("next",target),pr.elements.guides.setSizes(),pr.elements.ruler.show()}})}(__PageRuler),function(pr){pr.el.Guides=pr.cls(function(){var _this=this,guides=["top-left","top-right","bottom-left","bottom-right"];this.dom=pr.El.createEl("div",{id:"guides"}),this.dom.style.setProperty("width",pr.Util.px(pr.Dimensions.pageRight),"important"),this.dom.style.setProperty("height",pr.Util.px(pr.Dimensions.pageBottom),"important");for(var i=0,ilen=guides.length;ilen>i;i++){var position=guides[i],attrs={id:"guide-"+position,"class":["guide","guide-"+position]},key=position.replace(/\-\w/,function(char){return char.toUpperCase().replace("-","")});this[key]=pr.El.createEl("div",attrs),pr.El.appendEl(this.dom,this[key])}pr.El.appendEl(document.body,this.dom),this.setVisible(this.visible),pr.Dimensions.addUpdateCallback(function(width,height){_this.dom.style.setProperty("width",pr.Util.px(width),"important"),_this.dom.style.setProperty("height",pr.Util.px(height),"important"),_this.setSizes()})},{dom:null,visible:!0,topLeft:null,topRight:null,bottomLeft:null,bottomRight:null,each:function(callback){callback.call(this,this.topLeft),callback.call(this,this.topRight),callback.call(this,this.bottomLeft),callback.call(this,this.bottomRight)},setColor:function(hex){this.each(function(guide){guide.style.setProperty("border-color",hex,"important")})},setSizes:function(){this.setVisible(this.visible,!1);var ruler=pr.elements.ruler,leftWidth=ruler.left+1,rightWidth=pr.Dimensions.pageRight-ruler.right+1;0>rightWidth&&(rightWidth=0);var topHeight=ruler.top+1,bottomHeight=pr.Dimensions.pageBottom-ruler.bottom+1;0>bottomHeight&&(bottomHeight=0),this.topLeft.style.setProperty("width",pr.Util.px(leftWidth),"important"),this.topLeft.style.setProperty("height",pr.Util.px(topHeight),"important"),this.topRight.style.setProperty("width",pr.Util.px(rightWidth),"important"),this.topRight.style.setProperty("height",pr.Util.px(topHeight),"important"),this.bottomLeft.style.setProperty("width",pr.Util.px(leftWidth),"important"),this.bottomLeft.style.setProperty("height",pr.Util.px(bottomHeight),"important"),this.bottomRight.style.setProperty("width",pr.Util.px(rightWidth),"important"),this.bottomRight.style.setProperty("height",pr.Util.px(bottomHeight),"important")},hide:function(){this.dom.style.setProperty("display","none","important")},show:function(){this.dom.style.removeProperty("display")},setVisible:function(visible,save){this.visible=!!visible,this.visible===!0?this.show():this.hide(),save&&chrome.runtime.sendMessage({action:"setGuides",visible:this.visible})}})}(__PageRuler),function(pr){pr.el.Mask=pr.cls(function(){var _this=this;this.dom=pr.El.createEl("div",{id:"mask"}),this.dom.style.setProperty("width",pr.Util.px(pr.Dimensions.pageRight),"important"),this.dom.style.setProperty("height",pr.Util.px(pr.Dimensions.pageBottom),"important"),pr.El.appendEl(document.body,this.dom),pr.Dimensions.addUpdateCallback(function(width,height){_this.dom.style.setProperty("width",pr.Util.px(width),"important"),_this.dom.style.setProperty("height",pr.Util.px(height),"important")}),pr.El.registerListener(this.dom,"mousedown",function(){document.activeElement.blur()})},{dom:null})}(__PageRuler),function(pr){pr.el.Resize=pr.cls(function(ruler,id,cls){for(var directions={top:!1,bottom:!1,left:!1,right:!1},positions=id.split("-"),i=0,ilen=positions.length;ilen>i;i++)directions[positions[i]]=!0;var attrs={id:"resize-"+id,"class":[cls,id]};this.dom=pr.El.createEl("div",attrs),pr.El.registerListener(this.dom,"mousedown",function(e){var mouseX=pr.Mouse.getX(e),mouseY=pr.Mouse.getY(e);e.stopPropagation(),e.preventDefault(),ruler.resizingLeft=directions.left,ruler.resizingTop=directions.top,ruler.resizingBottom=directions.bottom,ruler.resizingRight=directions.right,directions.left&&(ruler.resizingOffsetLeft=mouseX-ruler.left),directions.top&&(ruler.resizingOffsetTop=mouseY-ruler.top),directions.bottom&&(ruler.resizingOffsetBottom=ruler.bottom-mouseY),directions.right&&(ruler.resizingOffsetRight=ruler.right-mouseX)}),pr.El.registerListener(this.dom,"mouseup",function(){ruler.resizingLeft=!1,ruler.resizingTop=!1,ruler.resizingBottom=!1,ruler.resizingRight=!1,ruler.resizingOffsetLeft=0,ruler.resizingOffsetTop=0,ruler.resizingOffsetBottom=0,ruler.resizingOffsetRight=0})},{dom:null,setColor:function(hex){this.dom.style.setProperty("border-color",hex,"important")}})}(__PageRuler),function(pr){pr.el.Ruler=pr.cls(function(toolbar,guides){var _this=this;this.toolbar=toolbar,this.toolbar.ruler=this,this.guides=guides,this.createDom(),this.reset(),pr.El.registerListener(this.ruler,"mousedown",function(e){e.stopPropagation(),e.preventDefault(),document.activeElement.blur(),_this.movingLeft=!0,_this.movingTop=!0}),pr.El.registerListener(this.ruler,"mouseup",function(){_this.movingLeft=!1,_this.gapLeft=null,_this.resizingLeft=!1,_this.movingTop=!1,_this.gapTop=null,_this.resizingTop=!1,_this.resizingRight=!1,_this.resizingBottom=!1}),pr.El.registerListener(document,"mousedown",function(e){if(!_this.toolbar.elementToolbar.tracking&&"html"!==e.target.tagName.toLowerCase()){pr.elements.guides.hide();var mouseXY=pr.Mouse.getXY(e),mouseX=mouseXY.x,mouseY=mouseXY.y;e.preventDefault(),e.stopPropagation(),_this.reset({left:mouseX,top:mouseY,width:2,height:2}),_this.resizingRight=!0,_this.resizingBottom=!0,_this.show()}}),pr.El.registerListener(document,"mouseup",function(){_this.movingLeft=!1,_this.movingTop=!1,_this.movingRight=!1,_this.movingDown=!1,_this.resizingLeft=!1,_this.resizingTop=!1,_this.resizingRight=!1,_this.resizingBottom=!1}),pr.El.registerListener(document,"mousemove",function(e){if(_this.toolbar.elementToolbar.tracking&&!pr.El.inElement(e.target,_this.toolbar.dom)){e.preventDefault(),e.stopPropagation();var mouseXY=pr.Mouse.getClientXY(e,!0),mouseX=mouseXY.x,mouseY=mouseXY.y;pr.elements.mask.dom.style.setProperty("display","none","important"),_this.ruler.style.setProperty("display","none","important"),_this.guides.visible&&_this.guides.hide(),_this.toolbar.elementToolbar.setElement(document.elementFromPoint(mouseX,mouseY)),pr.elements.mask.dom.style.removeProperty("display"),_this.ruler.style.removeProperty("display"),_this.guides.visible&&_this.guides.show()}else _this.move(e),_this.resize(e)})},{toolbar:null,ruler:null,guides:null,resizeElements:{top:null,bottom:null,left:null,right:null,topLeft:null,topRight:null,bottomLeft:null,bottomRight:null},width:0,height:0,left:0,resizingLeft:!1,resizingOffsetLeft:0,top:0,resizingTop:!1,resizingOffsetTop:0,right:0,resizingRight:!1,resizingOffsetRight:0,bottom:0,resizingBottom:!1,resizingOffsetBottom:0,movingLeft:!1,movingTop:!1,gapLeft:null,gapTop:null,keyMoving:!0,createDom:function(){var _this=this;this.ruler=pr.El.createEl("div");var container=pr.El.createEl("div",{id:"container","class":"container"});this.resizeElements.top=new pr.el.Resize(this,"top","edge"),this.resizeElements.bottom=new pr.el.Resize(this,"bottom","edge"),this.resizeElements.left=new pr.el.Resize(this,"left","edge"),this.resizeElements.right=new pr.el.Resize(this,"right","edge"),this.resizeElements.topLeft=new pr.el.Resize(this,"top-left","corner"),this.resizeElements.topRight=new pr.el.Resize(this,"top-right","corner"),this.resizeElements.bottomLeft=new pr.el.Resize(this,"bottom-left","corner"),this.resizeElements.bottomRight=new pr.el.Resize(this,"bottom-right","corner"),pr.El.appendEl(container,[this.resizeElements.top.dom,this.resizeElements.bottom.dom,this.resizeElements.left.dom,this.resizeElements.right.dom,this.resizeElements.topLeft.dom,this.resizeElements.topRight.dom,this.resizeElements.bottomLeft.dom,this.resizeElements.bottomRight.dom]),pr.El.appendEl(this.ruler,container),pr.El.appendEl(document.body,this.ruler),chrome.runtime.sendMessage({action:"getColor"},function(color){_this.setColor(color,!1)})},show:function(){this.ruler.style.removeProperty("display")},hide:function(){this.ruler.style.setProperty("display","none","important")},setColor:function(hex,save){this.ruler.style.setProperty("border-color",hex,"important"),this.ruler.style.setProperty("background-color",pr.Util.hexToRGB(hex,.2),"important"),this.resizeElements.topLeft.setColor(hex),this.resizeElements.topRight.setColor(hex),this.resizeElements.bottomLeft.setColor(hex),this.resizeElements.bottomRight.setColor(hex),this.guides.setColor(hex),this.toolbar.setColor(hex),save&&chrome.runtime.sendMessage({action:"setColor",color:hex})},reset:function(config){config=config||{},this.width=config.width||0,this.toolbar.setWidth(this.width),this.height=config.height||0,this.toolbar.setHeight(this.height),this.left=config.left||0,this.resizingLeft=!1,this.resizingOffsetLeft=0,this.toolbar.setLeft(this.left),this.top=config.top||0,this.resizingTop=!1,this.resizingOffsetTop=0,this.toolbar.setTop(this.top),this.right=this.left+this.width,this.resizingRight=!1,this.resizingOffsetRight=0,this.toolbar.setRight(this.right),this.bottom=this.top+this.height,this.resizingBottom=!1,this.resizingOffsetBottom=0,this.toolbar.setBottom(this.bottom),this.movingLeft=!1,this.movingTop=!1,this.gapLeft=null,this.gapTop=null,this.ruler.style.width=pr.Util.px(this.width),this.ruler.style.height=pr.Util.px(this.height),this.ruler.style.top=pr.Util.px(this.top),this.ruler.style.left=pr.Util.px(this.left),this.hide()},setLeft:function(left,updateRight){left=parseInt(left,10),isNaN(left)?left=this.left:0>left?left=0:left>pr.Dimensions.pageRight-this.width?left=pr.Dimensions.pageRight-this.width:left<pr.Dimensions.pageLeft&&(left=pr.Dimensions.pageLeft),this.left=left,this.ruler.style.setProperty("left",pr.Util.px(left),""),!0===updateRight&&this.setRight(left+this.width),this.toolbar.setLeft(left),this.guides.setSizes()},setTop:function(top,updateBottom){top=parseInt(top,10),isNaN(top)?top=this.top:0>top?top=0:top>pr.Dimensions.pageBottom+this.height?top=pr.Dimensions.pageBottom-this.height:top<pr.Dimensions.pageTop&&(top=pr.Dimensions.pageTop),this.top=top,this.ruler.style.setProperty("top",pr.Util.px(top),""),!0===updateBottom&&this.setBottom(top+this.height),this.toolbar.setTop(top),this.guides.setSizes()},setRight:function(right,updateLeft){right=parseInt(right,10),isNaN(right)?right=this.right:right<pr.Dimensions.pageLeft+this.width?right=pr.Dimensions.pageLeft+this.width:right>pr.Dimensions.pageRight?right=pr.Dimensions.pageRight:right>pr.Dimensions.pageRight&&(right=pr.Dimensions.pageRight,this.setLeft(right-this.width,!1)),this.right=right,!0===updateLeft&&this.setLeft(right-this.width,!1),this.toolbar.setRight(right),this.guides.setSizes()},setBottom:function(bottom,updateTop){bottom=parseInt(bottom,10),isNaN(bottom)?bottom=this.bottom:bottom<pr.Dimensions.pageTop+this.height?bottom=pr.Dimensions.pageTop+this.height:bottom>pr.Dimensions.pageBottom&&(bottom=pr.Dimensions.pageBottom,this.setTop(bottom-this.height)),this.bottom=bottom,!0===updateTop&&this.setTop(bottom-this.height,!1),this.toolbar.setBottom(bottom),this.guides.setSizes()},setGapLeft:function(mouseX,onlyIfNull){(!0!==onlyIfNull||null===this.gapLeft&&!0===onlyIfNull)&&(this.gapLeft=mouseX-this.left)},setGapTop:function(mouseY,onlyIfNull){(!0!==onlyIfNull||null===this.gapTop&&!0===onlyIfNull)&&(this.gapTop=mouseY-this.top)},moveLeft:function(e){if(this.movingLeft){var mouseX=pr.Mouse.getX(e);this.setGapLeft(mouseX,!0),mouseX-this.gapLeft<pr.Dimensions.pageLeft?mouseX=pr.Dimensions.pageLeft+this.gapLeft:mouseX-this.gapLeft+this.width>pr.Dimensions.pageRight&&(mouseX=pr.Dimensions.pageRight-this.width+this.gapLeft),this.setLeft(mouseX-this.gapLeft,!0)}},moveTop:function(e){if(this.movingTop){var mouseY=pr.Mouse.getY(e);this.setGapTop(mouseY,!0),mouseY-this.gapTop<pr.Dimensions.pageTop?mouseY=pr.Dimensions.pageTop+this.gapTop:mouseY-this.gapTop+this.height>pr.Dimensions.pageBottom&&(mouseY=pr.Dimensions.pageBottom-this.height+this.gapTop),this.setTop(mouseY-this.gapTop,!0)}},move:function(e){this.moveLeft(e),this.moveTop(e)},resizeLeft:function(e){if(this.resizingLeft){var mouseX=pr.Mouse.getX(e);mouseX<=this.right?(mouseX<pr.Dimensions.pageLeft&&(mouseX=pr.Dimensions.pageLeft),mouseX-=this.resizingOffsetLeft,this.setLeft(mouseX),this.setWidth(this.right-mouseX)):(this.resizingLeft=!1,this.resizingRight=!0,this.setLeft(this.right))}},resizeRight:function(e){if(this.resizingRight){var mouseX=pr.Mouse.getX(e);mouseX>=this.left?(mouseX>pr.Dimensions.pageRight&&(mouseX=pr.Dimensions.pageRight),mouseX+=this.resizingOffsetRight,this.setRight(mouseX),this.setWidth(mouseX-this.left)):(this.resizingLeft=!0,this.resizingRight=!1,this.setRight(this.left))}},resizeTop:function(e){if(this.resizingTop){var mouseY=pr.Mouse.getY(e);mouseY<=this.bottom?(mouseY<pr.Dimensions.pageTop&&(mouseY=pr.Dimensions.pageTop),mouseY-=this.resizingOffsetTop,this.setTop(mouseY),this.setHeight(this.bottom-mouseY)):(this.resizingTop=!1,this.resizingBottom=!0,this.setTop(this.bottom))}},resizeBottom:function(e){if(this.resizingBottom){var mouseY=pr.Mouse.getY(e);mouseY>=this.top?(mouseY>pr.Dimensions.pageBottom&&(mouseY=pr.Dimensions.pageBottom),mouseY+=this.resizingOffsetBottom,this.setBottom(mouseY),this.setHeight(mouseY-this.top)):(this.resizingTop=!0,this.resizingBottom=!1,this.setBottom(this.top))}},resize:function(e){this.resizeLeft(e),this.resizeRight(e),this.resizeTop(e),this.resizeBottom(e)},setWidth:function(width){width=parseInt(width,10),isNaN(width)?width=this.width:0>width?width=0:width+this.left>pr.Dimensions.pageRight&&(width=pr.Dimensions.pageRight-this.left),this.width=width,this.ruler.style.setProperty("width",pr.Util.px(width),""),this.setRight(this.left+width),this.toolbar.setWidth(width),this.guides.setSizes()},setHeight:function(height){height=parseInt(height,10),isNaN(height)?height=this.height:0>height?height=0:height+this.top>pr.Dimensions.pageBottom&&(height=pr.Dimensions.pageBottom-this.top),this.height=height,this.ruler.style.setProperty("height",pr.Util.px(height),""),this.setBottom(this.top+height),this.toolbar.setHeight(height),this.guides.setSizes()}})}(__PageRuler),function(pr){pr.el.Toolbar=pr.cls(function(){var _this=this;this.dom=pr.El.createEl("div",{id:"toolbar",cls:this.position},{click:function(e){e.stopPropagation()},mousedown:function(e){e.stopPropagation()}});var container=pr.El.createEl("div",{id:"toolbar-container","class":"toolbar-container"}),closeContainer=this.generateCloseContainer(),dockContainer=this.generateDockContainer(),helpContainer=this.generateHelpContainer(),elementModeContainer=this.generateElementModeToggleContainer(),dimensionsContainer=this.generateDimensionsContainer(),positionContainer=this.generatePositionContainer(),colorContainer=this.generateColorContainer(),guidesContainer=this.generateGuidesContainer();
pr.El.appendEl(container,[closeContainer,dockContainer,helpContainer,elementModeContainer,dimensionsContainer,positionContainer,colorContainer,guidesContainer]),this.elementToolbar=new pr.el.ElementToolbar(this),pr.El.appendEl(this.dom,[container,this.elementToolbar.dom]),pr.El.appendEl(document.documentElement,this.dom),chrome.runtime.sendMessage({action:"getDockPosition"},function(position){_this.setDockPosition(position)}),chrome.runtime.sendMessage({action:"getGuides"},function(visible){pr.elements.guides.setVisible(visible,!1),pr.elements.guides.hide(),visible||(_this.els.guides.checked=!1)})},{position:"top",height:30,ruler:null,dom:null,els:{},elementMode:!1,elementToolbar:null,generatePixelInput:function(id,labelText,changeListener){var container=pr.El.createEl("div",{id:"toolbar-"+id+"-container",cls:"px-container"}),label=pr.El.createEl("label",{id:"toolbar-"+id+"-label","for":"toolbar-"+id},{},labelText+":");return this.els[id]=pr.El.createEl("input",{id:"toolbar-"+id,type:"number",min:0,value:0,title:labelText.toLocaleLowerCase()}),pr.El.registerListener(this.els[id],"change",changeListener),pr.El.registerListener(this.els[id],"keydown",function(e){!e.shiftKey||38!==e.keyCode&&40!==e.keyCode||(e.preventDefault(),38===e.keyCode?this.value=parseInt(this.value,10)+10:40===e.keyCode&&(this.value=parseInt(this.value,10)-10),changeListener.call(this,e)),13===e.keyCode&&changeListener.call(this,e)}),pr.El.registerListener(this.els[id],"focus",function(){pr.elements.ruler.keyMoving=!1}),pr.El.registerListener(this.els[id],"blur",function(){pr.elements.ruler.keyMoving=!0}),pr.El.appendEl(container,[label,this.els[id]]),container},shiftPage:function(height){if(this.unshiftPage(),height=height||this.height+(this.elementMode?this.elementToolbar.height:0),"top"===this.position){var cssTransform="transform"in document.body.style?"transform":"-webkit-transform";document.body.style.setProperty(cssTransform,"translateY("+pr.Util.px(height)+")","important")}else document.body.style.setProperty("margin-bottom",pr.Util.px(height),"important")},unshiftPage:function(){var cssTransform="transform"in document.body.style?"transform":"-webkit-transform";document.body.style.removeProperty(cssTransform),document.body.style.removeProperty("margin-bottom")},generateElementModeToggleContainer:function(){var _this=this,label=pr.El.createEl("span",{id:"toolbar-element-toggle-label",style:"display:none !important;"},{},pr.Util.locale("toolbarEnableElementMode")),img=pr.El.createEl("img",{id:"toolbar-element-toggle-img",src:chrome.extension.getURL("images/element-mode-toggle.png")}),container=pr.El.createEl("div",{id:"toolbar-element-toggle",cls:["container","element-toggle-container"]},{mouseover:function(){label.style.removeProperty("display")},mouseout:function(){_this.elementMode===!1&&label.style.setProperty("display","none","important")},click:function(e){e.preventDefault(),e.stopPropagation(),_this.elementMode===!1?_this.showElementToolbar():_this.hideElementToolbar()}});return pr.El.appendEl(container,[label,img]),container},generateDimensionsContainer:function(){var _this=this,container=pr.El.createEl("div",{id:"toolbar-dimensions",cls:"container"}),width=this.generatePixelInput("width",pr.Util.locale("toolbarWidth"),function(){_this.ruler.setWidth(this.value),chrome.runtime.sendMessage({action:"trackEvent",args:["Action","Ruler Change","Width"]})}),height=this.generatePixelInput("height",pr.Util.locale("toolbarHeight"),function(){_this.ruler.setHeight(this.value),chrome.runtime.sendMessage({action:"trackEvent",args:["Action","Ruler Change","Height"]})});return pr.El.appendEl(container,[width,height]),container},generatePositionContainer:function(){var _this=this,container=pr.El.createEl("div",{id:"toolbar-positions",cls:"container"}),left=this.generatePixelInput("left",pr.Util.locale("toolbarLeft"),function(){_this.ruler.setLeft(this.value,!0),chrome.runtime.sendMessage({action:"trackEvent",args:["Action","Ruler Change","Left"]})}),top=this.generatePixelInput("top",pr.Util.locale("toolbarTop"),function(){_this.ruler.setTop(this.value,!0),chrome.runtime.sendMessage({action:"trackEvent",args:["Action","Ruler Change","Top"]})}),right=this.generatePixelInput("right",pr.Util.locale("toolbarRight"),function(){_this.ruler.setRight(this.value,!0),chrome.runtime.sendMessage({action:"trackEvent",args:["Action","Ruler Change","Right"]})}),bottom=this.generatePixelInput("bottom",pr.Util.locale("toolbarBottom"),function(){_this.ruler.setBottom(this.value,!0),chrome.runtime.sendMessage({action:"trackEvent",args:["Action","Ruler Change","Bottom"]})});return pr.El.appendEl(container,[left,top,right,bottom]),container},generateColorContainer:function(){var _this=this,container=pr.El.createEl("div",{id:"toolbar-color-container","class":"container"}),label=pr.El.createEl("label",{id:"toolbar-color-label","for":"toolbar-color"},{},pr.Util.locale("toolbarColor")+":");return this.els.color=pr.El.createEl("input",{id:"toolbar-color",type:"color"}),pr.El.registerListener(this.els.color,"change",function(e){_this.ruler.setColor(e.target.value,!0)}),pr.El.appendEl(container,[label,this.els.color]),container},generateGuidesContainer:function(){var guidesContainer=pr.El.createEl("div",{id:"toolbar-guides-container",cls:"container"}),label=pr.El.createEl("label",{id:"toolbar-guides-label","for":"toolbar-guides-input"},{},pr.Util.locale("toolbarGuides")+":"),lang=(navigator.language||"").split("-")[0];lang&&(lang="lang_"+lang);var toggle=pr.El.createEl("div",{id:"toolbar-guides-toggle",cls:"checkbox-toggle "+lang}),input=pr.El.createEl("input",{id:"toolbar-guides-input",type:"checkbox",checked:!0},{change:function(){pr.elements.guides.setVisible(this.checked,!0)}});this.els.guides=input;var toggleLabel=pr.El.createEl("label",{id:"toolbar-guides-toggle-label","for":"toolbar-guides-input"}),labelInner=pr.El.createEl("div",{id:"toolbar-guides-label-inner","class":"inner"}),labelSwitch=pr.El.createEl("div",{id:"toolbar-guides-label-switch","class":"switch "+lang});return pr.El.appendEl(toggleLabel,[labelInner,labelSwitch]),pr.El.appendEl(toggle,[input,toggleLabel]),pr.El.appendEl(guidesContainer,[label,toggle]),guidesContainer},generateCloseContainer:function(){var container=pr.El.createEl("div",{id:"toolbar-close-container","class":["container","close-container"]}),img=pr.El.createEl("img",{id:"toolbar-close",src:chrome.extension.getURL("images/close.png"),title:pr.Util.locale("toolbarClose","lowercase")},{click:function(){chrome.runtime.sendMessage({action:"disable"})}});return pr.El.appendEl(container,[img]),container},generateHelpContainer:function(){var container=pr.El.createEl("div",{id:"toolbar-help-container","class":["container","help-container"]});return this.els.help=pr.El.createEl("img",{id:"toolbar-help",src:chrome.extension.getURL("images/help-white.png"),title:pr.Util.locale("toolbarHelp","lowercase")},{click:function(){chrome.runtime.sendMessage({action:"openHelp"})}}),pr.El.appendEl(container,[this.els.help]),container},generateDockContainer:function(){var _this=this,container=pr.El.createEl("div",{id:"toolbar-dock-container","class":["container","dock-container"]});return this.els.dock=pr.El.createEl("img",{id:"toolbar-dock",src:chrome.extension.getURL("images/dock-bottom.png"),title:pr.Util.locale("toolbarDockBottom","lowercase")},{click:function(){_this.setDockPosition("top"===_this.position?"bottom":"top",!0)}}),pr.El.appendEl(container,[this.els.dock]),container},setDockPosition:function(position,save){if("top"===position||"bottom"===position){var oldPosition="top"===position?"bottom":"top";pr.El.removeClass(this.dom,"page-ruler-"+oldPosition),this.position=position,pr.El.addClass(this.dom,"page-ruler-"+position),this.els.dock.setAttribute("src",chrome.extension.getURL("images/dock-"+oldPosition+".png")),this.els.dock.setAttribute("title",pr.Util.locale("toolbarDock"+("top"===oldPosition?"Top":"Bottom"),"lowercase")),this.shiftPage(),save&&chrome.runtime.sendMessage({action:"setDockPosition",position:position})}},setColor:function(color){this.els.color.value=color},setWidth:function(width){this.els.width.value=parseInt(width,10)},setHeight:function(height){this.els.height.value=parseInt(height,10)},setTop:function(top){this.els.top.value=parseInt(top,10)},setBottom:function(bottom){this.els.bottom.value=parseInt(bottom,10)},setLeft:function(left){this.els.left.value=parseInt(left,10)},setRight:function(right){this.els.right.value=parseInt(right,10)},showElementToolbar:function(){this.elementMode=!0,this.elementToolbar.show(),document.getElementById("page-ruler-toolbar-element-toggle-label").innerText=pr.Util.locale("toolbarDisableElementMode")},hideElementToolbar:function(){this.elementMode=!1,this.elementToolbar.hide(),document.getElementById("page-ruler-toolbar-element-toggle-label").innerText=pr.Util.locale("toolbarEnableElementMode")}})}(__PageRuler);