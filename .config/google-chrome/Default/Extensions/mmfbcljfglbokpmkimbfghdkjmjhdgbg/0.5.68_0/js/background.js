function c(){this.b=[];this.a=[]}function e(){var a=parseInt(navigator.appVersion.match(/Chrome\/(\d+)\./)[1],10),b="other";-1!=navigator.appVersion.indexOf("Linux")?b="linux":-1!=navigator.appVersion.indexOf("CrOS")?b="cros":-1!=navigator.appVersion.indexOf("Mac OS X")&&(b="mac");return"linux"===b&&27>a||"mac"===b&&25>a}
c.prototype.c=function(){var a={id:"appWindow"+this.a.length,frame:e()?"chrome":"none",minWidth:400,minHeight:400,width:700,height:700};chrome.app.window.create("index.html",a,function(a){console.log("Window opened:",a);a.onClosed.addListener(this.h.bind(this,a))}.bind(this))};
c.prototype.g=function(a){var b=[];chrome.storage.local.get("retainedEntryIds",function(a){a=a.retainedEntryIds||[];for(var b=0;b<a.length;b++)chrome.fileSystem.restoreEntry(a[b],function(a){this.b.push(a)}.bind(this))}.bind(this));if(a&&a.items)for(var d=0;d<a.items.length;d++)b.push(a.items[d].entry);0==this.a.length&&this.c();for(d=0;d<b.length;d++)chrome.fileSystem.getWritableEntry(b[d],function(a){0<this.a.length?this.a[0].openEntries([a]):this.b.push(a)}.bind(this))};
c.prototype.h=function(a){console.log("Window closed:",a);if(a.contentWindow&&a.contentWindow.textApp){a=a.contentWindow.textApp;for(var b=0;b<this.a.length;b++)a===this.a[b]&&this.a.splice(b,1);a=a.getFilesToRetain();console.log("Got "+a.length+" files to retain:",a);for(var b=[],d=0;d<a.length;d++){var g=chrome.fileSystem.retainEntry(a[d]);b.push(g)}chrome.storage.local.set({retainedEntryIds:b})}else console.warn("No TextApp object in the window being closed:",a.contentWindow,a.contentWindow.textApp)};
c.prototype.i=function(a){this.a.push(a);a.setHasChromeFrame(e());0<this.b.length?(a.openEntries(this.b),this.b=[]):a.openNew()};c.prototype.f=function(a,b){chrome.fileSystem.getWritableEntry(a,b)};var f=new c;chrome.app.runtime.onLaunched.addListener(f.g.bind(f));window.background=f;c.prototype.copyFileEntry=c.prototype.f;c.prototype.onWindowReady=c.prototype.i;c.prototype.newWindow=c.prototype.c;