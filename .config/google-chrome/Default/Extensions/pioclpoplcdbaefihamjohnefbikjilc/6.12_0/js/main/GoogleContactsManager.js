/*! Copyright 2009-2017 Evernote Corporation. All rights reserved. */

!function(){function a(){}a.prototype.invalidate=function(){var a=Persistent.get("googleConnection");a&&(a[account.userInfo.userId]=null),Persistent.set("googleConnection",a)},a.prototype.refresh=function(){var a=Persistent.get("googleConnection"),b=Persistent.get("userLastUpdated")||0;return account.reload().then(function(c){if(!a||!a[c.userId]||a[c.userId].version<2||Date.now()>=a[c.userId].expires||b>a[c.userId].lastQueried)return new Promise(function(a){extension.createUtilityClient().getOAuthCredential(c.authenticationToken,OAUTH_CREDENTIAL_SERVICE_GOOGLE_CONNECT,function(b){a({credential:b})},function(b){a({error:b})})})}).then(function(b){return account.isAuthenticated&&b&&(a=a||{},b.credential?(a[account.userInfo.userId]={lastQueried:Date.now(),connected:!0,expires:b.credential.expires,version:2},Persistent.set("googleConnection",a)):"EDAMNotFoundException"===b.error.__proto__.name&&"OAuthCredential"===b.error.identifier||"EDAMUserException"===b.error.__proto__.name&&b.error.code===EDAMErrorCode.DATA_CONFLICT?(a[account.userInfo.userId]={lastQueried:Date.now(),connected:!1,version:2},Persistent.set("googleConnection",a)):b.error&&log.error(b.error)),a?a[account.userInfo.userId]:null})},window.googleContactsManager=new a}();