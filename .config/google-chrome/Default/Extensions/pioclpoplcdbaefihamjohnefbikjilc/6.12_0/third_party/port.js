/*! Copyright 2009-2017 Evernote Corporation. All rights reserved. */

"undefined"==typeof SAFARI&&function(){if(SAFARI="undefined"!=typeof safari,SAFARI){SAFARI_VERSION=(navigator.appVersion.match(/\sSafari\/(\d+)\./)||[null,0])[1],LEGACY_SAFARI=SAFARI_VERSION<534;var a=!!safari.extension.bars,b=function(){return safari.self&&safari.self.addEventListener?safari.self:safari.application&&safari.application.addEventListener?safari.application:(console.log("No add/remove event listener possible at this location!"),console.trace(),{addEventListener:function(){},removeEventListener:function(){}})},c=function(a,c){var d=function(b){b.name==a&&c(b)};return b().addEventListener("message",d,!1),d},d=function(a){b().removeEventListener("message",a,!1)},e=function(a){var b=a;if(b&&b.target&&b.target.page&&b.target.page.dispatchMessage)return b.target.page;var c=safari.self;if(c&&c.tab&&c.tab.dispatchMessage)return c.tab;var d=safari.application&&safari.application.activeBrowserWindow,e=d&&d.activeTab&&d.activeTab.page;return e&&e.dispatchMessage?e:(console.log("No dispatchMessage possible at this location!"),console.trace(),{dispatchMessage:function(){}})},f=function(){var a=[],b=0;return function(c){return a=a.filter(function(a){return null!=a.browserWindow}),void 0==c.id&&(c.id=b+1,b=c.id,a.push(c)),c.id}}();chrome={extension:{getBackgroundPage:function(){return safari.extension.globalPage.contentWindow},getURL:function(a){return safari.extension.baseURI+a},sendMessage:function(){function b(a,b){var e="callback"+Math.random();f.forEach(function(b){var c={data:a,callbackToken:e};b.dispatchMessage("request",c)});var g=c("response",function(a){a.message.callbackToken==e&&(window.setTimeout(function(){d(g)},0),b&&b(a.message.data))})}var f=[];return a?c("onRequest registration",function(a){var b=e(a);f.indexOf(b)==-1&&f.push(b)}):f.push(e()),b}(),onMessage:{addListener:function(b){a||e().dispatchMessage("onRequest registration",{}),c("request",function(c){var d=c.message.data,g={};if(a){var h=f(c.target);g.tab={id:h,url:c.target.url}}b(d,g,function(a){var b={callbackToken:c.message.callbackToken,data:a};e(c).dispatchMessage("response",b)})})}},connect:function(a){var b="portUuid"+Math.random(),d={name:a.name,uuid:b};return e().dispatchMessage("port-create",d),{name:a.name,onMessage:{addListener:function(a){c("port-postMessage",function(c){c.message.portUuid==b&&a(c.message.data)})}}}},onConnect:{addListener:function(a){c("port-create",function(b){var c=b.message.name,d=b.message.uuid,g=f(b.target),h={name:c,sender:{tab:{id:g,url:b.target.url}},onDisconnect:{addListener:function(){}},postMessage:function(a){e(b).dispatchMessage("port-postMessage",{portUuid:d,data:a})}};a(h)})}},onRequestExternal:{addListener:function(){}}},i18n:function(){function a(a,b){var c=new XMLHttpRequest;c.open("GET",chrome.extension.getURL(a),!1),c.onreadystatechange=function(){4==this.readyState&&""!=this.responseText&&b(this.responseText)};try{c.send()}catch(a){}}function b(a,b){function c(a,b,c){a=a.replace(/\$\$/g,"~~~I18N~~:"),a=a.replace(b,c);return a=a.replace(/~~~I18N~~:/g,"$$$$")}if(void 0==a.placeholders&&void 0==b)return a.message.replace(/\$\$/g,"$");var d=function(a,c){try{return b[c-1]}catch(a){return""}},e={};for(var f in a.placeholders){var g=a.placeholders[f].content;e[f.toLowerCase()]=c(g,/\$([1-9])/g,d)}var h=c(a.message,/\$([1-9])/g,d);return h=c(h,/\$(\w+?)\$/g,function(a,b){var c=b.toLowerCase();return c in e?e[c]:a}),h=h.replace(/\$\$/g,"$")}var c=void 0;return{_getL10nData:function(){var b={locales:[]};b.locales.push(navigator.language.replace("-","_")),navigator.language.length>2&&b.locales.push(navigator.language.substring(0,2)),b.locales.indexOf("en")==-1&&b.locales.push("en"),b.messages={};for(var c=0;c<b.locales.length;c++){var d=b.locales[c];a("_locales/"+d+"/messages.json",function(a){b.messages[d]=JSON.parse(a)})}return b},_setL10nData:function(a){c=a},getMessage:function(a,d){void 0==c&&chrome.i18n._setL10nData(chrome.i18n._getL10nData()),"string"==typeof d&&(d=[d]);for(var e=0;e<c.locales.length;e++){var f=c.messages[c.locales[e]];if(f&&a in f)return b(f[a],d)}return""}}}()}}}(),"undefined"!=typeof EDGE&&"undefined"!=typeof FIREFOX||function(){if(EDGE=!1,FIREFOX=!1,"undefined"!=typeof browser||"undefined"!=typeof msbrowser){chrome="undefined"!=typeof browser?browser:msbrowser;var a=chrome.extension.getURL("");a.startsWith("ms-browser")?(EDGE=!0,FIREFOX=!1):a.startsWith("moz-extension")&&(FIREFOX=!0,EDGE=!1)}}();