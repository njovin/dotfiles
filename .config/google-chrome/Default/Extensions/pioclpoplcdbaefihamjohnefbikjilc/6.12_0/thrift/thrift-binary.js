/*! Copyright 2009-2017 Evernote Corporation. All rights reserved. */

Thrift.BinaryProtocol=function(a,b,c){this.transport=this.trans=a,this.strictRead=void 0!==b&&b,this.strictWrite=void 0===c||c},Thrift.BinaryParser={fromByte:function(a){return new Int8Array([a]).buffer},fromShort:function(a){a=parseInt(a);var b=new ArrayBuffer(2);return new DataView(b).setInt16(0,a),b},fromInt:function(a){a=parseInt(a);var b=new ArrayBuffer(4);return new DataView(b).setInt32(0,a),b},fromLong:function(a){if(a=parseInt(a),Math.abs(a)>=Math.pow(2,53))throw new Error("Unable to accurately transfer numbers larger than 2^53 - 1 as integers. Number provided was "+a);var b=(Array(64).join("0")+Math.abs(a).toString(2)).slice(-64);a<0&&(b=this.twosCompliment(b));for(var c=new ArrayBuffer(8),d=new DataView(c),e=0;e<8;e++){var f=parseInt(b.substr(8*e,8),2);d.setUint8(e,f)}return c},twosCompliment:function(a){var b=a.lastIndexOf("1");return a=a.substring(0,b).replace(/1/g,"x").replace(/0/g,"1").replace(/x/g,"0")+a.substring(b)},fromDouble:function(a){var b=new ArrayBuffer(8);return new DataView(b).setFloat64(0,a),b},fromString:function(a){var b,c=unescape(encodeURIComponent(a)),d=c.length,e=new Uint8Array(d);for(b=0;b<d;b++)e[b]=c.charCodeAt(b);return e.buffer},toByte:function(a){return a.getUint8(0)},toBytes:function(a){return new Uint8Array(a.buffer,a.byteOffset,a.byteLength)},toShort:function(a){return a.getInt16(0)},toInt:function(a){return a.getInt32(0)},toLong:function(a){for(var b=1,c="",d=0;d<8;d++)c+=(Array(8).join("0")+a.getUint8(d).toString(2)).slice(-8);"1"===c[0]&&(b=-1,c=this.twosCompliment(c));var e=c.indexOf("1");if(e!=-1&&e<10)throw new Error("Unable to receive number larger than 2^53 - 1 as an integer");return parseInt(c,2)*b},toDouble:function(a){return a.getFloat64(0)},toString:function(a){var b,c,d="",e=a.byteLength;for(b=0;b<e;b++)c=a.getUint8(b).toString(16),1==c.length&&(c="0"+c),d+="%"+c;return d=decodeURIComponent(d)}},function(a){var b=Thrift.BinaryParser;a.flush=function(){return this.trans.flush()};var c=Thrift.Type;a.writeMessageBegin=function(a,b,c){this.strictWrite?(this.writeI32(-2147418112|b),this.writeString(a),this.writeI32(c)):(this.writeString(a),this.writeByte(b),this.writeI32(c))},a.writeMessageEnd=function(){},a.writeStructBegin=function(a){},a.writeStructEnd=function(){},a.writeFieldBegin=function(a,b,c){this.writeByte(b),this.writeI16(c)},a.writeFieldEnd=function(){},a.writeFieldStop=function(){this.writeByte(c.STOP)},a.writeMapBegin=function(a,b,c){this.writeByte(a),this.writeByte(b),this.writeI32(c)},a.writeMapEnd=function(){},a.writeListBegin=function(a,b){this.writeByte(a),this.writeI32(b)},a.writeListEnd=function(){},a.writeSetBegin=function(a,b){console.log("write set",a,b),this.writeByte(a),this.writeI32(b)},a.writeSetEnd=function(){},a.writeBool=function(a){a?this.writeByte(1):this.writeByte(0)},a.writeByte=function(a){this.trans.write(b.fromByte(a))},a.writeBinary=function(a){if("string"==typeof a&&(a=b.fromString(a)),!a.byteLength)throw Error("Cannot read length of binary data");this.writeI32(a.byteLength),this.trans.write(a)},a.writeI16=function(a){this.trans.write(b.fromShort(a))},a.writeI32=function(a){this.trans.write(b.fromInt(a))},a.writeI64=function(a){this.trans.write(b.fromLong(a))},a.writeDouble=function(a){this.trans.write(b.fromDouble(a))},a.writeString=function(a){var c=b.fromString(a);this.writeI32(c.byteLength),this.trans.write(c)},a.readMessageBegin=function(){var a,b,c,d=this.readI32().value;if(d<0){var e=d&-65536;if(e!=-2147418112)throw console.log("BAD: "+e),Error("Bad version in readMessageBegin: "+d);a=255&d,b=this.readString().value,c=this.readI32().value}else{if(this.strictRead)throw Error("No protocol version header");b=this.trans.read(d),a=this.readByte().value,c=this.readI32().value}return{fname:b,mtype:a,rseqid:c}},a.readMessageEnd=function(){},a.readStructBegin=function(){return{fname:""}},a.readStructEnd=function(){},a.readFieldBegin=function(){var a=this.readByte().value;return a==c.STOP?{fname:null,ftype:a,fid:0}:{fname:null,ftype:a,fid:this.readI16().value}},a.readFieldEnd=function(){},a.readMapBegin=function(){return this.rstack=[],this.rpos=[1],{ktype:this.readByte().value,vtype:this.readByte().value,size:this.readI32().value}},a.readMapEnd=function(){},a.readListBegin=function(){return{etype:this.readByte().value,size:this.readI32().value}},a.readListEnd=function(){},a.readSetBegin=function(){return{etype:this.readByte().value,size:this.readI32().value}},a.readSetEnd=function(){},a.readBool=function(){return 0==this.readByte().value?{value:!1}:{value:!0}},a.readByte=function(){var a=this.trans.read(1);return{value:b.toByte(a)}},a.readI16=function(){var a=this.trans.read(2);return{value:b.toShort(a)}},a.readI32=function(){var a=this.trans.read(4);return{value:b.toInt(a)}},a.readI64=function(){var a=this.trans.read(8);return{value:b.toLong(a)}},a.readDouble=function(){var a=this.trans.read(8);return{value:b.toDouble(a)}},a.readBinary=function(){var a=this.readI32().value,c=this.trans.read(a);return{value:b.toBytes(c)}},a.readString=function(){var a=this.readI32().value,c=this.trans.read(a);return{value:b.toString(c)}},a.getTransport=function(){return this.trans},a.skip=function(a){switch(a){case c.STOP:return;case c.BOOL:this.readBool();break;case c.BYTE:this.readByte();break;case c.I16:this.readI16();break;case c.I32:this.readI32();break;case c.I64:this.readI64();break;case c.DOUBLE:this.readDouble();break;case c.STRING:this.readString();break;case c.STRUCT:for(this.readStructBegin();;){var b=this.readFieldBegin();if(b.ftype===c.STOP)break;this.skip(b.ftype),this.readFieldEnd()}this.readStructEnd();break;case c.MAP:for(var b=this.readMapBegin(),d=0;d<b.size;++d)this.skip(b.ktype),this.skip(b.vtype);this.readMapEnd();break;case c.SET:for(var b=this.readSetBegin(),d=0;d<b.size;++d)this.skip(b.etype);this.readSetEnd();break;case c.LIST:for(var b=this.readListBegin(),d=0;d<b.size;++d)this.skip(b.etype);this.readListEnd();break;default:throw Error("Invalid type: "+a)}}}(Thrift.BinaryProtocol.prototype),Thrift.BinaryHttpTransport=function(a){this.url=a,this.buffer=[],this.received=null,this.offset=0},function(a){a.open=function(){},a.close=function(){},a.read=function(a){var b=new DataView(this.received,this.offset,a);return this.offset+=a,b},a.write=function(a){this.buffer.push(a)},a.flush=function(a){if(!a)throw"Error in BinaryHttpTransport.flush: Binary protocol does not support synchronous calls";var b=this.buffer.reduce(function(a,b){return a+b.byteLength},0),c=new Uint8Array(new ArrayBuffer(b)),d=0;return this.buffer.forEach(function(a){var b=null;b=a.buffer?a instanceof Uint8Array?a:new Uint8Array(a.buffer,a.byteOffset,a.byteLength):new Uint8Array(a),c.set(b,d),d+=a.byteLength}),this.buffer=[],c},a.send=function(a,b,c,d){c=Array.prototype.slice.call(c,0);var e=c.pop(),f=c.length>0?c.pop():e;"function"!=typeof f&&(f=e);var g=new XMLHttpRequest;g.open("POST",this.url,!0),g.setRequestHeader("Content-Type","application/x-thrift"),g.setRequestHeader("Accept","application/x-thrift"),g.responseType="arraybuffer",g.onload=function(b){this.received=g.response,this.offset=0;try{var c=d.call(a)}catch(a){c=a,f=e}f(c)}.bind(this),g.onerror=function(a){e(a)},g.send(b.buffer)}}(Thrift.BinaryHttpTransport.prototype);