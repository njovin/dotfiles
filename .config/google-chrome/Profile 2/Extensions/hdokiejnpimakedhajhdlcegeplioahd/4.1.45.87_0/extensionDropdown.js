ExtensionDropdown=function(e){var t=$(e.body),n=e.getElementById("items"),o=e.getElementById("searchResults"),i=e.getElementById("recentSites"),l=e.getElementById("identitiesMenuItem"),a=e.getElementById("matchingSitesTopLevel"),s=e.getElementById("matchingSites"),r=$("#topLevelContainer"),c=$("#vaultMenuItem"),u=$("#groupLabel"),p=$("#backButton"),d=$("#debugconsole"),g=$("#encryptedExportMenuItem"),m=$("#wifiExportMenuItem"),f=$("#matchingSitesMenuItem"),b=$("#recentSitesMenuItem"),v=$("#container"),h=$("#searchInput"),P=$("#applicationsMenuItem"),I=null,L=null,y=null,T=null,S=null,_=null,C=null,E=null,w=!1,M=!1,D=!1,x=!1,k={},A=null,F={},N=[],R={},B=function(e){if(u.empty(),e){var t=e.getName();t=t.replace(/\\/g," \\ ");var n=t.indexOf("\\",t.length/2);if(n===-1&&(n=t.lastIndexOf("\\")),n>0){var o=LPTools.createElement("div","textOverflowContainer groupLabel");o.appendChild(LPTools.createElement("span",null,t.substring(0,n))),u.append(LPTools.createElement("span","textTail","Â "+t.substring(n))),u.append(o),LPTools.setupMiddleEllipsis(u)}else u.append(LPTools.createElement("span","groupLabel",t));u.find(".groupLabel").attr("title",e.toString())}};R.GroupState=function(e){var t=LPTools.getNavIndex();this.pop=function(){e.rebuildItems(),LPTools.setNavIndex(t),B(e._model)}},R.SearchState=function(){var e=new R.CSSState("searchItem",{restoreKeyboardNav:!1});this.pop=function(){Q(),e.pop()}},R.TopLevelMatchingSitesState=function(e){var t=new R.CSSState("matchingSites"),n=new R.GroupState(e);this.pop=function(){n.pop(),t.pop()}},R.CSSState=function(){var e=t.attr("class"),n=function(n){t.removeClass(e),t.addClass(n),e=n};return function(t,o){var i=e;n(t),LPTools.getOption(o,"applyKeyboardNav",!0)&&LPTools.addKeyBoardNavigation($(".extensionMenuItem:visible"),{selectFirst:!0}),this.pop=function(){B(null),n(i),LPTools.getOption(o,"restoreKeyboardNav",!0)&&LPTools.addKeyBoardNavigation($(".extensionMenuItem:visible")),o&&"function"==typeof o.onPop&&o.onPop()}}}();var O=function(){LPTools.parseUserSpecificMenu(e.getElementById("mainMenu"),LPProxy.getAccountClass()),$("#username").text(bg.get("g_username")),K()},H=function(){v.addClass("loading"),W(),q(),O(),v.addClass("initialized"),h.focus(),setTimeout(function(){G()},0),bg.get("LPContentScriptFeatures").ziggy||$("#mainMenu").addClass("showIcons"),bg.sendLpImprove("openicondropdown")},K=function(){var e=function(){v.LP_removeAttr("style");var e=v.outerHeight();LPPlatform.setDropdownPopoverSize(e,v.outerWidth()),v.css("height",e),LPTools.addKeyBoardNavigation($(".extensionMenuItem:visible"))};return function(){0===N.length?e():N[0].pop=function(t){return function(){t(),e()}}(N[0].pop)}}(),z=function(){LPFeatures.updateFeatures({import:!0,noexport:!1,show_notes:!0,hideidentities:!1,show_formfills:!0})},G=function(){LPProxy.initializeModel(),j(),U(),M=!0,v.removeClass("loading");for(var e in F)F[e]();var t=h.val();t&&X(t),K()},V=function(e){var t;return LPProxy.getPreference("showAcctsInGroups",!0)&&(e=LPProxy.assignItemsToGroups(e,!1),t={separateFavorites:!0}),new Container(e,t)},U=function(){y=V(LPProxy.getSites()),y.setElement(n),T=V(LPProxy.getNotes()),T.setElement(n),S=new Container(LPProxy.getFormFills()),S.setElement(n),_=new Container(LPProxy.getApplications()),_.setElement(n),E=new Container(LPProxy.getAllItems(),{moreOptionsState:R.SearchState})},W=function(){d.LP_removeAttr("style"),g.LP_removeAttr("style"),m.LP_removeAttr("style"),P.LP_removeAttr("style"),bg.is_user_debug_enabled()&&d.show(),bg.have_binary()&&(g.show(),bg.LPPlatform.isWin()&&m.show()),LPTools.hasProperties(bg.get("g_applications"))&&P.show()},j=function(){if(L=LPProxy.getIdentities(),LPProxy.enableCurrentIdentity(L),L.length>0){ee(I);for(var t=[],n=0,o=L.length;n<o;++n)t.push(L[n].newDisplayObject());new IdentityContainer(t).initialize(e.getElementById("identities"))}else $(l).hide()},Y=function(e){return k[e]===!0},Z=function(e,t,n){for(var o=[],i=0,l=A.length;i<l;++i){var a=A[i].aid;o.push(new MatchingAccountDisplay(LPProxy.getSiteModel(a)))}var s=new Container(o,t);s.setElement(e),s.rebuildItems(),n&&K()},q=function(){A=bg.getmatchingsites(!1,!0,!1);for(var t=0,n=A.length;t<n;++t)k[A[t].aid]=!0;var o=bg.get("LPContentScriptFeatures").ziggy;o?(b.addClass("divider"),c.addClass("divider"),r.removeClass("hidden"),A.length>2?c.addClass("topLevelMatchesShadow"):(c.removeClass("topLevelMatchesShadow"),0===A.length&&(c.removeClass("divider"),r.addClass("hidden")))):(0===A.length?f.LP_removeAttr("style"):f.show(),c.removeClass("divider"),c.removeClass("topLevelMatchesShadow"),r.addClass("hidden")),o?te("topLevelMatchingSites",function(){Z(a,{autoExpandSingleItem:!1,moreOptionsElement:e.getElementById("matchingSites"),moreOptionsState:R.TopLevelMatchingSitesState,addLastClass:!1},!0)})():A.length>0&&$("#matchingSiteCounter").text(A.length)},J=function(){var e=bg.getClearRecentTime(),t=bg.Preferences.get("recentUsedCount"),n=y.getItemChildren().concat(T.getItemChildren());n.sort(VaultItemBaseDisplay.prototype.sortByMostRecent);for(var o=[],l=0,a=n.length;l<a&&l<t;++l){var s=n[l];s.getLastTouchValue()>=e&&o.push(s._model.newDisplayObject())}if(o.length>0){new Container(o,{sortFunction:VaultItemBaseDisplay.prototype.sortByMostRecent}).initialize(i)}else re(i)},Q=function(){LPTools.removeDOMChildren(o);for(var e=0,t=C.length;e<t;++e){var n=C[e],i=n.build();n.postBuild(i),o.appendChild(i)}if(0===C.length){var l=LPTools.buildEmptyPlaceholder(Strings.translateString("No Matching Results"),"extensionSearchPlaceholder",o);o.appendChild(l)}LPTools.addKeyBoardNavigation(o.children,{rightArrowSelector:".moreItem",selectFirst:!0})},X=function(){var e=null;return function(t){t.length>0?(M&&(C=E.getSearchResultItems(t),Q()),w||(ce("search",{applyKeyboardNav:!1,onPop:function(){h.val("")}}),w=!0)):e&&e.length>0&&(ue(),w=!1),e=t}}(),ee=function(t){var n=Strings.translateString("Identities")+" ("+t.getName()+")",o=l.firstChild;3!==o.nodeType?(o=e.createTextNode(n),l.insertBefore(o,l.firstChild)):o.textContent=n},te=function(e,t){return function(){M?t():F[e]=t}},ne=function(e){e&&(e.stopPropagation(),e.preventDefault())},oe=function(e){for(var t=null;null!==e&&null===(t=e.getAttribute("childview"));)e=e.parentElement;return t},ie=function(e){return e||(e={}),e.saveOptions={source:"icon"},e},le=function(e){bg.LPPlatform.openTabDialog("site",ie(e))},ae=function(e){bg.LPPlatform.openTabDialog("note",ie(e))},se=function(e){bg.LPPlatform.openTabDialog("formFill",ie(e))},re=function(e){e.appendChild(LPTools.createElement("li","extensionMenuItem none","None Available"))},ce=function(e,t){N.push(new R.CSSState(e,t))},ue=function(){var e=N.pop();e&&e.pop()},pe=function(){dialogs.generatePassword.getDialog().close(),p.unbind("click",pe)},de=null,ge=function(){dialogs.generatePassword.open({preSetup:function(e){if(null===de){var t=dialogs.generatePassword.parentElementID,n=e.options.hideHeader,o=e.dynamicHeight;de=function(){dialogs.generatePassword.parentElementID=t,e.options.hideHeader=n,e.useDynamicHeignt(o)}}dialogs.generatePassword.parentElementID="extensionDropdownGeneratePassword",e.options.hideHeader=!0,e.useDynamicHeignt(!1)},onClose:function(){ue()},onCopy:function(){LPPlatform.closePopup(!0)},saveOptions:{source:"icon"}}),p.unbind("click",pe),p.bind("click",pe)},me=function(e,t,n){if(e.isEmpty()){var o=LPTools.createElement("div","emptyView");o.appendChild(LPTools.createElement("img",{src:"images/vault_4.0/"+t,class:"emptyViewIcon"})),o.appendChild(LPTools.createElement("h1","emptyViewText",n)),document.getElementById("items").appendChild(o)}};h.LP_addSearchHandlers("inputDialog",function(e){X(e)}),p.bind("click",ue),$("[childview]").bind("click",function(e){ce(oe(e.target)),ne(e)}),$("#addSite").bind("click",function(e){bg.get_selected_tab_data_no_extension(null,function(e){bg.lpevent("m_add"),le({defaultData:{url:e?e.url:""}}),LPPlatform.closePopup()}),e.stopPropagation()}),$("#saveAllEnteredData").bind("click",function(){bg.lpevent("m_saed"),bg.saveall()}),$("#addNote").bind("click",function(){bg.lpevent("m_addn"),ae()}),$("#addFormFill").bind("click",function(){bg.lpevent("m_af"),se()}),$("#addCreditCard").bind("click",function(){bg.lpevent("m_af"),se({defaultData:{profiletype:FormFill.prototype.FORM_FILL_TYPE_CREDIT_CARD}})}),$("#clearForms").bind("click",function(){bg.lpevent("m_clrf"),bg.clearforms("icon")});var fe=null;$("#chooseProfile").bind("click",function(){dialogs.chooseProfile.open({preSetup:function(e){if(null===fe){var t=dialogs.chooseProfile.parentElementID,n=e.options.hideHeader;fe=function(){dialogs.chooseProfile.parentElementID=t,e.options.hideHeader=n,e.$element.css("min-height","")}}e.$element.css("min-height",0),dialogs.chooseProfile.parentElementID="chooseProfileCreditCard",e.options.hideHeader=!0},onClose:function(){ue()},saveOptions:{source:"icon"}})}),$("#vaultMenuItem").bind("click",function(){bg.lpevent("m_ov"),bg.openvault()}),$("#sitesMenuItem").bind("click",function(){return te("sites",function(){y.rebuildItems(n),me(y,"Empty_Site.png",Strings.translateString("Remember every password"))})}()),$("#formFillsMenuItem").bind("click",function(){return te("formFills",function(){S.rebuildItems(n),me(S,"Empty_Form.png",Strings.translateString("Fill Every Form"))})}()),$("#applicationsMenuItem").bind("click",function(){return te("applications",function(){_.rebuildItems(n),me(_,"Empty_Site.png",Strings.translateString("Remember every password"))})}()),$("#generateMenuItem").bind("click",ge),$("#notesMenuItem").bind("click",function(){return te("notes",function(){T.rebuildItems(n),me(T,"Empty_Note.png",Strings.translateString("Store Every Note"))})}()),$("#clearMostRecent").bind("click",function(){bg.clearrecent(),LPTools.removeDOMChildren(i),re(i)});var be=te("mostRecent",function(e){D||(J(),D=!0),LPTools.addKeyBoardNavigation(i.children,{rightArrowSelector:".moreItem",selectFirst:!0})});b.bind("click",be);var ve=te("matchingSites",function(t){x||(Z(s),x=!0),LPTools.addKeyBoardNavigation(e.getElementById("matchingSites").children,{rightArrowSelector:".moreItem",selectFirst:!0})});if(f.bind("click",ve),$("#prefMenuItem").bind("click",function(){bg.lpevent("m_op"),bg.openprefs()}),$("#helpMenuItem").bind("click",function(){bg.lpevent("m_oh"),bg.openhelp()}),$("#adminConsoleMenuItem").bind("click",function(){bg.lpevent("m_oec"),bg.openentconsole()}),$("#logoutMenuItem").bind("click",function(){bg.lpevent("m_lo"),bg.loggedOut(!1,"menu")}),$("#challengeMenuItem").bind("click",function(){bg.lpevent("m_sec"),bg.openseccheck()}),$("#favoritesMenuItem").bind("click",function(){bg.lpevent("m_of"),bg.openfavorites()}),$("#aboutMenuItem").bind("click",function(){bg.lpevent("m_abt"),bg.openabout()}),d.bind("click",function(){bg.lpevent("m_dbgcon"),bg.opendebugtab()}),$("#csvExportMenuItem").bind("click",function(){bg.lpevent("m_e"),bg.openexport()}),$("#formFillExportMenuItem").bind("click",function(){bg.lpevent("m_eff"),bg.formfillexport()}),g.bind("click",function(){bg.lpevent("m_elp"),bg.openlastpassexport()}),m.bind("click",function(){bg.lpevent("m_ewlan"),bg.wlanexport()}),$("#printSitesMenuItem").bind("click",function(){bg.lpevent("m_p"),bg.openprint(!1)}),$("#printNotesMenuItem").bind("click",function(){bg.lpevent("m_pn"),bg.openprint(!0)}),$("#refreshMenuItem").bind("click",function(){bg.lpevent("m_ref"),LPProxy.refreshSites()}),$("#clearCachMenuItem").bind("click",function(){bg.lpevent("m_cl"),bg.clearCache(!1,!0,!1)}),$("#myAccountMenuItem").bind("click",function(){bg.lpevent("m_mya"),bg.openmyaccount()}),$("#sessionsMenuItem").bind("click",function(){bg.lpevent("m_ses"),bg.opensessions()}),LPPlatform.addEventListener(window,"unload",function(){Le()}),t.on("click",".extensionMenuItem, .footer",function(){LPPlatform.closePopup()}),LPFeatures.allowGift()){var he=$("#specialOfferMenuItem");he.show(),he.bind("click",function(){bg.openURL(LPProxy.getBaseURL()+"gift.php")})}Topics.get(Topics.PUSH_STATE).subscribe(function(e){N.push(e)}),Topics.get(Topics.EDIT_SITE).subscribe(function(e){e.vaultItem=e.vaultItem.getID(),le(e)}),Topics.get(Topics.EDIT_NOTE).subscribe(function(e){e.vaultItem=e.vaultItem.getID(),ae(e)}),Topics.get(Topics.EDIT_FORM_FILL).subscribe(function(e){e.vaultItem=e.vaultItem.getID(),se(e)}),Topics.get(Topics.EDIT_APPLICATION).subscribe(function(e){e.vaultItem=e.vaultItem.getID(),bg.LPPlatform.openTabDialog("application",e)}),Topics.get(Topics.IDENTITY_ENABLE).subscribe(function(e){LPProxy.enableIdentity(e),I=e}),Topics.get(Topics.CONFIRM).subscribe(function(e){Pe("confirmation",e)}),Topics.get(Topics.ERROR).subscribe(function(e){Pe("alert",{title:Strings.Vault.ERROR,text:e})}),Topics.get(Topics.REPROMPT).subscribe(function(e){Pe("reprompt",{successCallback:e})}),Topics.get(Topics.LEFT_ARROW).subscribe(function(){LPTools.disableMouse(),ue()}),Topics.get(Topics.CLEAR_DATA).subscribe(function(){for(var e=N.length-1;e>-1;--e)N[e].pop();N=[],LPTools.setNavIndex(0),h.val(""),w=!1,M=!1,D=!1,x=!1,k={},F={},A=null,de&&de(),fe&&fe(),v.removeClass("initialized"),Dialog.prototype.closeAllDialogs(!0)}),Topics.get(Topics.INITIALIZED).subscribe(function(){Strings.translate(e.body),z(),LPPlatform.setupDropdownImportMenu(v)});var Pe=function(e,t){$("#container").LP_hide(),LPTools.removeKeyBoardNavigation(),t=$.extend(t,{onResize:function(e,t){LPPlatform.setDropdownPopoverSize(e,t)},onClose:function(){LPPlatform.closePopup()}}),LPDialog.openDialog(e,t)},Ie=function(){var e=bg.get("g_badgedata");if(e&&"notification"===e.cmd){switch(e.alerttype){case"duplicate":Pe("duplicatePassword",{notification:e});break;case"weak":Pe("weakPassword",{notification:e})}switch(e.type){case"error":Pe("notification",{notification:bg.get("g_notification_data")})}bg.clear_badge()}else $("#container").LP_show(),H()},Le=function(){Topics.get(Topics.CLEAR_DATA).publish()};return{setup:H,State:R,isMatchingSite:Y,setGroupLabel:B,open:Ie,openDialog:Pe,reset:Le,setBigIcons:function(e){bg.set("g_bigicons",e)}}}(document);